<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‡Œì¡¸ì¤‘ ì˜ˆë°© ì‹œìŠ¤í…œ API í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .test-section {
            margin-bottom: 30px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .result {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .status {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .status.online {
            color: #28a745;
            font-weight: bold;
        }
        .status.offline {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ ë‡Œì¡¸ì¤‘ ì˜ˆë°© ì‹œìŠ¤í…œ API í…ŒìŠ¤íŠ¸</h1>
        
        <div class="status" id="serverStatus">
            <span>ì„œë²„ ìƒíƒœ í™•ì¸ ì¤‘...</span>
        </div>

        <!-- ë¡œê·¸ì¸ -->
        <div class="card">
            <h2>1. ë¡œê·¸ì¸ (Login)</h2>
            <div class="grid">
                <div class="input-group">
                    <label>ì´ë©”ì¼</label>
                    <select id="loginEmail">
                        <option value="patient@test.com">í™˜ì (patient@test.com)</option>
                        <option value="caregiver@test.com">ë³´í˜¸ì (caregiver@test.com)</option>
                        <option value="doctor@test.com">ì˜ì‚¬ (doctor@test.com)</option>
                        <option value="admin@test.com">ê´€ë¦¬ì (admin@test.com)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPassword" value="patient">
                </div>
            </div>
            <button onclick="testLogin()">ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
            <div id="loginResult" class="result" style="display:none;"></div>
        </div>

        <!-- ê±´ê°• ë°ì´í„° ì œì¶œ -->
        <div class="card">
            <h2>2. ê±´ê°• ë°ì´í„° ì œì¶œ ë° ìœ„í—˜ë„ í‰ê°€</h2>
            <div class="grid">
                <div class="input-group">
                    <label>ë‚˜ì´</label>
                    <input type="number" id="age" value="65">
                </div>
                <div class="input-group">
                    <label>ì„±ë³„</label>
                    <select id="gender">
                        <option value="Male">ë‚¨ì„±</option>
                        <option value="Female">ì—¬ì„±</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>í‰ê·  í˜ˆë‹¹ (mg/dL)</label>
                    <input type="number" id="glucose" value="150">
                </div>
                <div class="input-group">
                    <label>BMI</label>
                    <input type="number" id="bmi" value="28.5" step="0.1">
                </div>
            </div>
            <button onclick="testHealthData()">ê±´ê°• ë°ì´í„° ì œì¶œ</button>
            <div id="healthResult" class="result" style="display:none;"></div>
        </div>

        <!-- FAST ê²€ì‚¬ -->
        <div class="card">
            <h2>3. FAST ê²€ì‚¬ (ì‘ê¸‰ ê²€ì‚¬)</h2>
            <div class="grid">
                <label><input type="checkbox" id="face"> ì–¼êµ´ ë¹„ëŒ€ì¹­ (Face)</label>
                <label><input type="checkbox" id="arms"> íŒ” ì•½í™” (Arms)</label>
                <label><input type="checkbox" id="speech"> ì–¸ì–´ ì¥ì•  (Speech)</label>
            </div>
            <button onclick="testFASTTest()">FAST ê²€ì‚¬ ìˆ˜í–‰</button>
            <div id="fastResult" class="result" style="display:none;"></div>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ -->
        <div class="card">
            <h2>4. ëŒ€ì‹œë³´ë“œ ì¡°íšŒ</h2>
            <button onclick="testDashboard()">ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì¡°íšŒ</button>
            <div id="dashboardResult" class="result" style="display:none;"></div>
        </div>

        <!-- API ë¬¸ì„œ ë§í¬ -->
        <div class="card">
            <h2>ğŸ“š API ë¬¸ì„œ</h2>
            <p>ì „ì²´ API ë¬¸ì„œëŠ” Swagger UIì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
            <a href="http://localhost:8000/docs" target="_blank">
                <button>API ë¬¸ì„œ ì—´ê¸° (Swagger UI)</button>
            </a>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        let sessionId = null;

        // ì„œë²„ ìƒíƒœ í™•ì¸
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_URL}/api/health`);
                const data = await response.json();
                document.getElementById('serverStatus').innerHTML = `
                    <span class="online">âœ… ì„œë²„ ì •ìƒ ì‘ë™ ì¤‘</span><br>
                    <small>ì‚¬ìš©ì: ${data.users_count}ëª… | ì„¸ì…˜: ${data.sessions_count}ê°œ</small>
                `;
                document.getElementById('serverStatus').className = 'status online';
            } catch (error) {
                document.getElementById('serverStatus').innerHTML = `
                    <span class="offline">âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨</span><br>
                    <small>ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</small>
                `;
                document.getElementById('serverStatus').className = 'status offline';
            }
        }

        // ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
        async function testLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // ë¹„ë°€ë²ˆí˜¸ ìë™ ì—…ë°ì´íŠ¸
            const passwordMap = {
                'patient@test.com': 'patient',
                'caregiver@test.com': 'caregiver',
                'doctor@test.com': 'doctor',
                'admin@test.com': 'admin'
            };
            document.getElementById('loginPassword').value = passwordMap[email];
            
            try {
                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({email, password: passwordMap[email]})
                });
                
                const data = await response.json();
                const resultDiv = document.getElementById('loginResult');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    sessionId = data.session_id;
                    resultDiv.className = 'result success';
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'Error: ' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                document.getElementById('loginResult').style.display = 'block';
                document.getElementById('loginResult').className = 'result error';
                document.getElementById('loginResult').textContent = 'Error: ' + error.message;
            }
        }

        // ê±´ê°• ë°ì´í„° ì œì¶œ
        async function testHealthData() {
            if (!sessionId) {
                alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”!');
                return;
            }
            
            const healthData = {
                age: parseInt(document.getElementById('age').value),
                gender: document.getElementById('gender').value,
                hypertension: 1,
                heart_disease: 0,
                ever_married: 'Yes',
                work_type: 'Private',
                Residence_type: 'Urban',
                avg_glucose_level: parseFloat(document.getElementById('glucose').value),
                bmi: parseFloat(document.getElementById('bmi').value),
                smoking_status: 'formerly smoked'
            };
            
            try {
                const response = await fetch(`${API_URL}/api/health-data?session_id=${sessionId}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(healthData)
                });
                
                const data = await response.json();
                const resultDiv = document.getElementById('healthResult');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'Error: ' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                document.getElementById('healthResult').style.display = 'block';
                document.getElementById('healthResult').className = 'result error';
                document.getElementById('healthResult').textContent = 'Error: ' + error.message;
            }
        }

        // FAST ê²€ì‚¬
        async function testFASTTest() {
            if (!sessionId) {
                alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”!');
                return;
            }
            
            const testData = {
                face_asymmetry: document.getElementById('face').checked,
                arm_weakness: document.getElementById('arms').checked,
                speech_difficulty: document.getElementById('speech').checked
            };
            
            try {
                const response = await fetch(`${API_URL}/api/fast-test?session_id=${sessionId}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                const resultDiv = document.getElementById('fastResult');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    resultDiv.className = data.is_emergency ? 'result error' : 'result success';
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'Error: ' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                document.getElementById('fastResult').style.display = 'block';
                document.getElementById('fastResult').className = 'result error';
                document.getElementById('fastResult').textContent = 'Error: ' + error.message;
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì¡°íšŒ
        async function testDashboard() {
            if (!sessionId) {
                alert('ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”!');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/dashboard?session_id=${sessionId}`);
                const data = await response.json();
                const resultDiv = document.getElementById('dashboardResult');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'Error: ' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                document.getElementById('dashboardResult').style.display = 'block';
                document.getElementById('dashboardResult').className = 'result error';
                document.getElementById('dashboardResult').textContent = 'Error: ' + error.message;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ ìƒíƒœ í™•ì¸
        checkServerStatus();
        setInterval(checkServerStatus, 10000); // 10ì´ˆë§ˆë‹¤ ìƒíƒœ í™•ì¸
    </script>
</body>
</html>
